name: Mongo Import Test

on: [push]

jobs:
  test-mongo:
    runs-on: ubuntu-latest
    services:
      mongodb:
        image: mongo

    steps:
      - uses: actions/checkout@v1
      - name: import data to mongo
        run: |
          docker cp testcol.json mongodb:/tmp/testcol.json
          docker exec mongodb mongoimport -d test -c testcol --file /tmp/testcol.json
        env:
          # use mongodb for the host here because we have specified a container for the job.
          # If we were running the job on the VM this would be localhost
          MONGODB_HOST: mongodb
          MONGODB_PORT: ${{ job.services.mongodb.ports[27017] }}
      - name: print data from mongo
        run: |
          docker exec mongodb mongoexport -d test -c testcol
        env:
          # use mongodb for the host here because we have specified a container for the job.
          # If we were running the job on the VM this would be localhost
          MONGODB_HOST: mongodb
          MONGODB_PORT: ${{ job.services.mongodb.ports[27017] }}
